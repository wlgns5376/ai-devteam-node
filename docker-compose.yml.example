version: '3.8'

services:
  ai-devteam:
    image: ai-devteam:v0.1
    container_name: ai-devteam
    
    # appuser 권한 설정 (UID:GID = 1001:1001)
    user: "1001:1001"
    
    environment:
      # 환경변수 설정 (실제 값은 .env.docker 파일이나 직접 설정)
      - GIT_USER_NAME=${GIT_USER_NAME}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GIT_ACCEPT_HOST_KEY=true
    
    volumes:
      # 기존 볼륨 마운트
      - ./.env.docker:/app/.env:ro
      - /path/to/your/workspace:/workspace
      # Claude 인증 정보 영속화 (핵심!)
      - ai_devteam_claude_auth:/home/appuser/.claude
    
    restart: unless-stopped
    
    # 헬스체크
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('Health check: OK')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  # Claude 인증 정보 볼륨 (가장 중요!)
  ai_devteam_claude_auth:
    driver: local